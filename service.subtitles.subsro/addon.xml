<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<addon id="service.subtitles.subsro"
       name="Subs.ro"
       version="1.0.11"
       provider-name="subs.ro">
	<requires>
		<import addon="xbmc.python" version="3.0.0"/>
		<import addon="script.module.requests" version="2.25.1+matrix.1"/>
	</requires>
	<extension point="xbmc.subtitle.module"
             library="service.py" />
	<extension point="xbmc.addon.metadata">
		<summary lang="en_GB">Subs.ro</summary>
		<summary lang="ro_RO">Subs.ro</summary>
		<description lang="en_GB">Search and download subtitles from Subs.ro - the largest Romanian subtitle database. Supports Romanian, English, Italian, French, German, Hungarian, Greek, Portuguese and Spanish. Register your account on subs.ro to get an API key before use.</description>
		<description lang="ro_RO">Cauta si descarca subtitrari de pe Subs.ro - cea mai mare baza de date de subtitrari romanesti. Suporta romana, engleza, italiana, franceza, germana, maghiara, greaca, portugheza si spaniola. Inregistreaza-te pe subs.ro pentru a obtine o cheie API.</description>
		<disclaimer lang="en_GB">Users need to provide a subs.ro API key in add-on configuration. You can generate an API key from your subs.ro user profile.</disclaimer>
		<news>
v1.0.11 (2026-02-25)
- CRITICAL FIX: Download no longer saves HTML login-redirect pages as .srt
  Previously, when website download returned an HTML page (requires login),
  the HTML was falsely detected as SRT (due to --> in JS comments) and saved.
  Kodi then failed with "Unable to create subtitle parser". Fixed by:
  a) archive_utils: require real SRT timestamp format, reject HTML signatures
  b) subtitle_downloader: skip download if Content-Type is text/html
- CRITICAL FIX: TV season filter no longer shows wrong seasons
  Previously "Sezonul 12" appeared when searching for S01E01 because the
  fallback returned ALL results when no season match was found. Now explicitly
  wrong-season results are excluded; only untagged packs and correct seasons remain
- FIX: archive_utils detects ZIP/RAR magic bytes and logs format for diagnostics
- Keep: All v1.0.10 fixes preserved

v1.0.10 (2026-02-25)
- CRITICAL FIX: Scraper results now display clean titles (html.unescape applied)
  Previously showed raw HTML entities like &amp;#x22;Grey&amp;#x27;s Anatomy&amp;#x22;
- CRITICAL FIX: Download now works for scraper results (dual download path)
  API download tried first with subtitle ID; if that fails, falls back to
  direct website download URL (downloadLink) from scraper results
- FIX: Scraper extracts ACTUAL title text from HTML anchor tags
  Previously used URL slugs which produced garbled titles
- FIX: TV season filter now matches scraper results properly
  Scraper titles now contain "Sezonul 1", "Sezoanele 1-22" etc.
- FIX: Multi-season packs ("Sezoanele 1-22") now matched by TV filter
  New regex detects season range and checks if requested season is within
- FIX: Scraper extracts download counts for proper result ranking
- FIX: Scraper cleans URL slugs with entity fragments (x22, x27)
- FIX: All text fields decoded with html.unescape() in list_subtitles()
- FIX: AJAX search removed (endpoint returns error, wastes time)
- Keep: All v1.0.3 through v1.0.9 fixes preserved

v1.0.9 (2026-02-24)
- CRITICAL FIX: Download action was NEVER executed -- THE root cause of "Attempt failed"
  get_params() now finds '?' and parses everything after it correctly

v1.0.8 (2026-02-24)
- Fix: download_subtitle() headers changed to Accept: */* for binary download
- Fix: download() error handling no longer passes phantom path to Kodi
- Fix: archive_content initialized before try block (UnboundLocalError prevention)
- Fix: Directory cleanup uses os.path.isdir() not xbmcvfs.exists()

v1.0.7 (2026-02-24)
- Aligned API calls with official subs.ro Stremio addon behavior
- TV show filtering returns ALL results when no S01E05 match (Stremio-style)
- Web scraping fallback (Strategy 11) when API returns no results

v1.0.6 (2026-02-24)
- Multi-strategy cascading search engine (up to 10 strategies per search)

v1.0.5 (2026-02-24)
- TV show/series subtitle search rewrite with parent/episode IMDB IDs
- Episode-aware archive extraction picks correct S01E05 from multi-episode ZIPs

v1.0.4 (2026-02-23)
- IMDB IDs sent with required 'tt' prefix

v1.0.3 (2026-02-23)
- Unsupported language codes no longer cause HTTP 400

v1.0.0 (2026-02-23)
- Initial release
		</news>
		<platform>all</platform>
		<license>GPL-3.0-only</license>
		<website>https://subs.ro</website>
		<assets>
			<icon>resources/media/subsro_logo_512x512.png</icon>
			<fanart>resources/media/subsro_fanart.jpg</fanart>
		</assets>
		<source>https://github.com/triffalin/repository.subsro</source>
	</extension>
</addon>
